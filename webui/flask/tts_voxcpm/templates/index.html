<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxCPM 语音合成</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>VoxCPM 语音合成演示</h1>
            <p class="subtitle">支持零样本声音克隆和高质量语音生成</p>
        </header>

        <div class="main-content">
            <!-- 左侧：控制面板 -->
            <div class="panel control-panel">
                <h2>控制面板</h2>
                
                <div class="form-group">
                    <label for="device">运行设备</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="device" value="cuda" id="device-cuda" checked>
                            <span>CUDA (GPU)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="device" value="cpu" id="device-cpu">
                            <span>CPU</span>
                        </label>
                    </div>
                    <small class="help-text">选择模型运行的设备（CPU 或 GPU）</small>
                </div>

                <div class="form-group">
                    <label for="text">待合成文本</label>
                    <textarea id="text" rows="4" placeholder="请输入需要合成的文本"></textarea>
                </div>

                <div class="form-group">
                    <label for="prompt-audio">参考音频</label>
                    <div class="audio-upload-area">
                        <input type="file" id="prompt-audio" accept="audio/*" style="display: none;">
                        <button type="button" id="upload-audio-btn" class="btn-secondary">选择音频文件</button>
                        <button type="button" id="use-default-audio-btn" class="btn-secondary">使用默认音频</button>
                    </div>
                    <audio id="prompt-audio-preview" controls class="audio-preview" style="display: none;"></audio>
                    <small class="help-text" id="audio-file-name">当前使用：默认参考音频</small>
                </div>

                <div class="form-group">
                    <label for="prompt-text">参考文本</label>
                    <textarea id="prompt-text" rows="2">{{ default_prompt_text }}</textarea>
                    <small class="help-text">参考音频对应的文本内容</small>
                </div>

                <div class="form-group">
                    <label for="cfg-value">CFG 值（引导尺度）: <span id="cfg-value-display">2.0</span></label>
                    <input type="range" id="cfg-value" min="1.0" max="3.0" step="0.1" value="2.0">
                    <small class="help-text">值越高对提示遵循越好，但质量可能下降</small>
                </div>

                <div class="form-group">
                    <label for="inference-timesteps">推理时间步数: <span id="timesteps-display">10</span></label>
                    <input type="range" id="inference-timesteps" min="4" max="30" step="1" value="10">
                    <small class="help-text">值越高质量越好，但速度越慢</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="normalize" checked>
                        <span>启用文本标准化</span>
                    </label>
                    <small class="help-text">使用外部工具进行文本标准化</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="denoise" checked>
                        <span>启用降噪</span>
                    </label>
                    <small class="help-text">使用外部降噪工具增强音质</small>
                </div>

                <details class="advanced-options">
                    <summary>高级选项</summary>
                    <div class="advanced-content">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="retry-badcase" checked>
                                <span>启用糟糕情况重试</span>
                            </label>
                            <small class="help-text">自动重试生成质量不佳的情况</small>
                        </div>

                        <div class="form-group">
                            <label for="retry-max-times">最大重试次数: <span id="retry-times-display">3</span></label>
                            <input type="range" id="retry-max-times" min="1" max="10" step="1" value="3">
                        </div>

                        <div class="form-group">
                            <label for="retry-ratio-threshold">糟糕情况检测阈值: <span id="retry-threshold-display">6.0</span></label>
                            <input type="range" id="retry-ratio-threshold" min="3.0" max="10.0" step="0.5" value="6.0">
                            <small class="help-text">长度比率阈值，可根据语速调整</small>
                        </div>
                    </div>
                </details>

                <div class="button-group">
                    <button id="load-btn" class="btn btn-primary">加载模型</button>
                    <button id="generate-btn" class="btn btn-success" disabled>生成语音</button>
                    <button id="stop-btn" class="btn btn-danger">停止生成</button>
                </div>
            </div>

            <!-- 右侧：输出面板 -->
            <div class="panel output-panel">
                <h2>输出结果</h2>
                
                <div class="form-group">
                    <label>状态</label>
                    <div id="status" class="status-box">等待操作...</div>
                </div>

                <div class="form-group">
                    <label>生成语音</label>
                    <audio id="audio-output" controls class="audio-player"></audio>
                    <div id="audio-placeholder" class="audio-placeholder">
                        <span></span>
                        <p>音频将在生成后显示</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', path='js/script.js') }}"></script>
</body>
</html>
