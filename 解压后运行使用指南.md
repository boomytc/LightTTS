# LightTTS 解压后运行使用指南

本指南详细说明了如何在目标机器上解压和运行 LightTTS 部署包。

## 📋 系统要求

- **操作系统**: macOS 或 Linux
- **磁盘空间**: 至少 5GB 可用空间
- **网络**: 首次运行时可能需要网络连接（用于下载模型）
- **权限**: 具有执行脚本的权限

## 📦 部署包内容

解压后的部署包包含以下文件：

```
lighttts_deployment_YYYYMMDD_HHMMSS/
├── lighttts_project.zip     # 项目源代码和模型文件
├── lighttts_env.zip         # 完整的Python环境
├── deploy.sh                # 自动部署脚本
└── README.md                # 说明文档
```

## 🚀 快速开始

### 步骤1: 解压部署包

```bash
# 解压主部署包
unzip lighttts_deployment_YYYYMMDD_HHMMSS.zip

# 进入解压目录
cd lighttts_deployment_YYYYMMDD_HHMMSS
```

### 步骤2: 运行部署脚本

```bash
# 给部署脚本添加执行权限（如果需要）
chmod +x deploy.sh

# 运行部署脚本
./deploy.sh
```

部署脚本会自动：
- 解压项目文件
- 解压conda环境
- 创建启动脚本
- 设置必要的权限

### 步骤3: 启动应用

```bash
# 启动 LightTTS WebUI
./start_lighttts.sh
```

## 📁 部署后的目录结构

部署完成后，目录结构如下：

```
lighttts_deployment_YYYYMMDD_HHMMSS/
├── cosyvoice/              # 核心代码模块
│   ├── cli/               # 命令行接口
│   ├── dataset/           # 数据处理
│   ├── flow/              # 流模型
│   ├── hifigan/           # 声码器
│   ├── llm/               # 语言模型
│   ├── tokenizer/         # 分词器
│   ├── transformer/       # Transformer模型
│   └── utils/             # 工具函数
├── pretrained_models/      # 预训练模型（如果存在）
│   └── CosyVoice2-0.5B/   # 主要模型文件
├── third_party/           # 第三方依赖
│   └── Matcha-TTS/        # Matcha-TTS库
├── lighttts_env/          # Python环境
│   ├── bin/               # 可执行文件
│   ├── lib/               # 库文件
│   └── ...
├── webui_cosyvoice2.py    # WebUI主程序
├── demo_cosyvoice2.py     # 演示程序
├── start_lighttts.sh      # 启动脚本
└── 原部署文件...
```

## 🔧 详细使用说明

### 启动脚本说明

`start_lighttts.sh` 脚本会：

1. **激活环境**: 激活打包的conda环境
2. **设置路径**: 配置PYTHONPATH
3. **启动WebUI**: 运行webui_cosyvoice2.py

### 手动启动方法

如果自动启动脚本有问题，可以手动启动：

```bash
# 激活conda环境
source lighttts_env/bin/activate

# 设置Python路径
export PYTHONPATH="$(pwd):$PYTHONPATH"

# 启动WebUI
python webui_cosyvoice2.py
```

### 运行演示程序

```bash
# 激活环境
source lighttts_env/bin/activate

# 运行演示
python demo_cosyvoice2.py
```

## 🌐 访问WebUI

启动成功后，在浏览器中访问：

```
http://localhost:7860
```

或者查看终端输出中显示的具体地址。

## ⚠️ 常见问题与解决方案

### 问题1: 权限不足

**症状**: 无法执行脚本

**解决方案**:
```bash
chmod +x deploy.sh
chmod +x start_lighttts.sh
```

### 问题2: 模型文件缺失

**症状**: 启动时提示找不到模型文件

**解决方案**: 模型会在首次运行时自动下载，请确保网络连接正常。

### 问题3: 端口被占用

**症状**: WebUI无法启动，提示端口7860被占用

**解决方案**: 
```bash
# 查找占用端口的进程
lsof -i :7860

# 杀死占用进程（替换PID）
kill -9 <PID>

# 或者修改webui_cosyvoice2.py中的端口号
```

### 问题4: 环境激活失败

**症状**: 无法激活conda环境

**解决方案**:
```bash
# 检查环境目录是否存在
ls -la lighttts_env/

# 手动激活
source lighttts_env/bin/activate

# 如果仍然失败，检查解压是否完整
```

### 问题5: Python模块找不到

**症状**: ImportError或ModuleNotFoundError

**解决方案**:
```bash
# 确保PYTHONPATH设置正确
export PYTHONPATH="$(pwd):$PYTHONPATH"

# 检查模块是否存在
ls -la cosyvoice/
ls -la third_party/
```

## 🔄 重新部署

如果需要重新部署：

```bash
# 清理当前部署
rm -rf cosyvoice pretrained_models third_party lighttts_env
rm -f start_lighttts.sh

# 重新运行部署脚本
./deploy.sh
```

## 📝 日志和调试

### 查看启动日志

```bash
# 启动时查看详细输出
./start_lighttts.sh 2>&1 | tee startup.log
```

### 调试模式

```bash
# 以调试模式启动
source lighttts_env/bin/activate
export PYTHONPATH="$(pwd):$PYTHONPATH"
python -u webui_cosyvoice2.py
```

## 🛑 停止应用

```bash
# 在终端中按 Ctrl+C 停止WebUI
# 或者找到进程并杀死
ps aux | grep webui_cosyvoice2
kill <PID>
```

## 📞 技术支持

如果遇到其他问题：

1. 检查终端输出的错误信息
2. 确认系统要求是否满足
3. 验证文件完整性
4. 查看日志文件

## 🎯 性能优化建议

- **内存**: 建议至少8GB RAM
- **存储**: 使用SSD可提高加载速度
- **网络**: 首次运行时确保网络稳定
- **CPU**: 多核CPU可提高推理速度

---

**注意**: 本指南基于zip格式的部署包，确保使用正确的解压命令和文件格式。